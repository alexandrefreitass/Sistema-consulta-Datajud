<!-- src/app/components/processo-consulta/processo-consulta.component.html -->
<div class="processo-consulta">
  <!-- Formul√°rio de Consulta -->
  <div class="formulario-consulta">
    <h2>Consultar Processo Judicial</h2>
    
    <form (ngSubmit)="onSubmit()" #consultaForm="ngForm">
      <div class="form-row">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Selecione o Tribunal</mat-label>
          <mat-select 
            [(ngModel)]="tribunalSelecionado" 
            name="tribunal"
            required>
            @for (tribunal of tribunais; track tribunal.alias) {
              <mat-option [value]="tribunal.alias">
                {{ tribunal.nome }}
              </mat-option>
            }
          </mat-select>
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>N√∫mero do Processo</mat-label>
          <input 
            matInput 
            [(ngModel)]="numeroProcesso"
            name="numeroProcesso"
            placeholder="Ex: 1234567-89.2023.8.26.0001"
            required>
        </mat-form-field>
      </div>

      <div class="form-actions">
        <button 
          mat-raised-button 
          color="primary" 
          type="submit"
          [disabled]="isLoading || consultaEmAndamento"
          class="btn-consultar">
          @if (isLoading || consultaEmAndamento) {
            <span>‚è≥ Consultando...</span>
          } @else {
            <span>üîç Consultar Processo</span>
          }
        </button>
        
        @if (consultaFeita) {
          <button 
            mat-stroked-button 
            color="warn"
            type="button"
            (click)="limparConsulta()"
            [disabled]="isLoading || consultaEmAndamento"
            class="btn-limpar">
            üóëÔ∏è Limpar Consulta
          </button>
        }
      </div>
    </form>
  </div>

  <!-- √Årea de Resultados - Sempre presente para evitar layout shift -->
  <div class="resultados-container" [class.visible]="consultaFeita">
    
    <!-- Estado: Processo Encontrado -->
    <div class="resultado-consulta" [class.show]="consultaFeita && processo" [class.hide]="!consultaFeita || !processo">
      <h3>Detalhes do Processo Judicial</h3>
      
      @if (processo) {
        <div class="processo-info">
          <div class="info-grid">
            <div class="info-item">
              <label>ID do Processo:</label>
              <span>{{ processo._id }}</span>
            </div>
            
            <div class="info-item">
              <label>N√∫mero do Processo:</label>
              <span>{{ processo._source.numeroProcesso }}</span>
            </div>
            
            <div class="info-item">
              <label>Classe:</label>
              <span>{{ processo._source.classe.nome }}</span>
            </div>
            
            <div class="info-item">
              <label>Sistema:</label>
              <span>{{ processo._source.sistema.nome }}</span>
            </div>
            
            <div class="info-item">
              <label>√ìrg√£o Julgador:</label>
              <span>{{ processo._source.orgaoJulgador.nome }}</span>
            </div>
            
            <div class="info-item">
              <label>Data de Ajuizamento:</label>
              <span>{{ formatarData(processo._source.dataAjuizamento) }}</span>
            </div>
            
            <div class="info-item">
              <label>√öltima Atualiza√ß√£o:</label>
              <span>{{ formatarData(processo._source.dataHoraUltimaAtualizacao) }}</span>
            </div>
            
            <div class="info-item">
              <label>Tribunal:</label>
              <span>{{ processo._source.tribunal }}</span>
            </div>
            
            <div class="info-item">
              <label>Grau:</label>
              <span>{{ processo._source.grau }}</span>
            </div>
          </div>
        </div>

        <!-- Movimenta√ß√µes -->
        @if (processo._source.movimentos && processo._source.movimentos.length > 0) {
          <div class="movimentacoes">
            <h4>Movimenta√ß√µes do Processo ({{ processo.totalMovimentos }} total)</h4>
            
            <div class="table-container">
              <table class="movimentos-table">
                <thead>
                  <tr>
                    <th>Data/Hora</th>
                    <th>C√≥digo</th>
                    <th>Nome do Movimento</th>
                    <th>Complementos</th>
                  </tr>
                </thead>
                <tbody>
                  @for (movimento of getMovimentosPaginados(); track $index) {
                    <tr>
                      <td>{{ formatarData(movimento.dataHora) }}</td>
                      <td>{{ movimento.codigo }}</td>
                      <td>{{ movimento.nome }}</td>
                      <td>
                        @if (movimento.complementosTabelados && movimento.complementosTabelados.length > 0) {
                          <ul class="complementos-list">
                            @for (complemento of movimento.complementosTabelados; track $index) {
                              <li>{{ complemento.nome }}</li>
                            }
                          </ul>
                        } @else {
                          <span class="sem-complementos">-</span>
                        }
                      </td>
                    </tr>
                  }
                </tbody>
              </table>
            </div>

            <!-- Pagina√ß√£o -->
            @if (processo.totalMovimentos > itemsPerPage) {
              <div class="paginacao">
                <button 
                  mat-button 
                  (click)="paginaAnterior()" 
                  [disabled]="!hasPreviousPage()">
                  Anterior
                </button>
                
                <span class="page-info">
                  P√°gina {{ page }} - Mostrando {{ getMovimentosPaginados().length }} de {{ processo.totalMovimentos }}
                </span>
                
                <button 
                  mat-button 
                  (click)="proximaPagina()" 
                  [disabled]="!hasNextPage()">
                  Pr√≥xima
                </button>
              </div>
            }
          </div>
        }
      }
    </div>

    <!-- Estado: Nenhum Resultado -->
    <div class="no-result" [class.show]="consultaFeita && !processo" [class.hide]="!consultaFeita || processo">
      <h3>Nenhum resultado encontrado</h3>
      <p>N√£o foram encontradas informa√ß√µes para o processo consultado.</p>
    </div>

    <!-- Estado: Carregando -->
    <div class="loading-state" [class.show]="isLoading || consultaEmAndamento" [class.hide]="!isLoading && !consultaEmAndamento">
      <div class="loading-content">
        <div class="spinner"></div>
        <h3>Consultando processo...</h3>
        <p>Aguarde enquanto buscamos as informa√ß√µes do processo judicial.</p>
      </div>
    </div>

  </div>
</div>